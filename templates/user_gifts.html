<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ site_name }} - Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
</head>
<body>
  <div class="mobile-wrap">

    <div class="top-card">
      <div class="badge-icon">ğŸ</div>
      <div style="margin-top:10px;">
        <div class="page-title">Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§</div>
        <div class="page-subtitle">Ø±ØµÙŠØ¯Ùƒ: {{ user.points }} Ù†Ù‚Ø·Ø©</div>
      </div>
      <div style="margin-top:10px;">
        <a href="{{ url_for('user_dashboard') }}" style="color:var(--muted);text-decoration:none;font-weight:800;">â¬… Ø±Ø¬ÙˆØ¹</a>
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="section">
          {% for cat, msg in messages %}
            <div style="padding:10px;border-radius:14px;margin-bottom:8px;border:1px solid var(--stroke);
              background: {{ 'rgba(34,197,94,.10)' if cat=='ok' else 'rgba(239,68,68,.10)' }};">
              {{ msg }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="section">
      <div class="section-title">Ø§Ø®ØªØ± Ù‡Ø¯ÙŠØ©</div>

      <div style="display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:12px;">
        {% for g in gifts %}
          <div class="quick-item" style="padding:12px;text-align:right;">
            <div style="display:flex;gap:12px;align-items:center;">
              <div class="gift-thumb">
                {% if g.image_filename %}
                  {# 1) Ø¥Ø°Ø§ Ù…Ø®Ø²Ù† Ø±Ø§Ø¨Ø· ÙƒØ§Ù…Ù„ (Ù‚Ø¯ÙŠÙ…) #}
                  {% if '://' in g.image_filename %}
                    <img src="{{ g.image_filename }}" alt="">
                  {% else %}
                    {# 2) Ø¥Ø°Ø§ Ø¹Ù†Ø¯Ù†Ø§ supabase base (Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©) #}
                    {% if storage_public_base %}
                      <img src="{{ storage_public_base ~ g.image_filename }}" alt="">
                    {% else %}
                      {# 3) fallback Ù…Ø­Ù„ÙŠ #}
                      <img src="{{ url_for('static', filename='uploads/' ~ g.image_filename) }}" alt="">
                    {% endif %}
                  {% endif %}
                {% else %}
                  <div style="height:100%;display:flex;align-items:center;justify-content:center;opacity:.6;font-size:26px;">ğŸ</div>
                {% endif %}
              </div>

              <div style="flex:1;">
                <div style="font-weight:900;">{{ g.name }}</div>
                <div class="muted small" style="margin-top:4px;">{{ g.points_required }} Ù†Ù‚Ø·Ø©</div>

                <div style="margin-top:10px;">
                  {% if user.points >= g.points_required %}
                    <form method="post" action="{{ url_for('user_redeem', gift_id=g.id) }}">
                      <button class="btn-yellow" type="submit" style="padding:10px;border-radius:14px;">Ø·Ù„Ø¨ Ø§Ù„Ù‡Ø¯ÙŠØ©</button>
                    </form>
                  {% else %}
                    <button class="btn-yellow" type="button" disabled
                            style="padding:10px;border-radius:14px;background:rgba(255,255,255,.10);color:var(--muted);cursor:not-allowed;">
                      ØºÙŠØ± ÙƒØ§ÙÙŠ
                    </button>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      {% if gifts|length == 0 %}
        <div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‡Ø¯Ø§ÙŠØ§ Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>
      {% endif %}
    </div>

  </div>
</body>
</html>
